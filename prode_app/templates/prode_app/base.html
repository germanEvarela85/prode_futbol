<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>PRODE</title>
    {% load static %}
    <link rel="stylesheet" href="{% static 'style.css' %}">
</head>
<body>

<div class="container">

{% if user.is_authenticated %}
    <header>
        <h1>PRODE F√∫tbol</h1>
        <p>
            Hola, {{ user.username }} |
            <form method="post" action="{% url 'logout' %}" style="display:inline;">
                {% csrf_token %}
                <button type="submit" class="button secondary">Cerrar sesi√≥n</button>
            </form>
        </p>

        {% if primer_partido and cierre_prode %}
        <p style="font-size: 0.9em; color: gray;">
            üïí Primer partido: {{ primer_partido|date:"d/m/Y H:i" }} |
            ‚è±Ô∏è Cierre prode: {{ cierre_prode|date:"d/m/Y H:i" }}
        </p>
        <p id="contador" style="color: blue; font-weight:bold;"></p>
        <script>
            const cierre = new Date("{{ cierre_prode|date:'Y-m-d H:i:s' }}").getTime();
            const contadorElem = document.getElementById('contador');
            function actualizarContador() {
                const now = new Date().getTime();
                let diff = cierre - now;
                if(diff <= 0) {
                    contadorElem.innerText = "‚õî El prode ya cerr√≥";
                    clearInterval(intervalo);
                    return;
                }
                const h = Math.floor(diff / (1000*60*60));
                const m = Math.floor((diff % (1000*60*60)) / (1000*60));
                const s = Math.floor((diff % (1000*60)) / 1000);
                contadorElem.innerText = `Tiempo restante para cerrar: ${h}h ${m}m ${s}s`;
            }
            const intervalo = setInterval(actualizarContador, 1000);
            actualizarContador();
        </script>
        {% endif %}
    </header>

    <nav>
        <a href="{% url 'mis_tarjetas' %}" class="button secondary">Mis Tarjetas</a>
        <a href="{% url 'crear_tarjeta' %}" class="button">Crear Tarjeta</a>
        <a href="{% url 'ranking_fecha' 1 %}" class="button secondary">Ranking</a>
        <a href="{% url 'subir_comprobante' %}">Subir comprobante</a>

        {% if user.is_superuser %}
            <a href="{% url 'cargar_resultados' 1 %}" class="button boton-rojo">Cargar Resultados</a>
        {% endif %}

        <form action="{% url 'buscar_tarjeta' %}" method="get" class="search-form" style="display:inline-block; margin-left:20px;">
            <input type="text" name="q" placeholder="Buscar tarjeta..." required>
            <button type="submit" class="button secondary">Buscar</button>
        </form>
    </nav>

    <hr>

{% else %}
    <p>
        <a href="{% url 'login' %}" class="button secondary">Iniciar sesi√≥n</a>
        <a href="{% url 'registro' %}" class="button">Registrarse</a>
    </p>
{% endif %}

{% block content %}
{% endblock %}

</div>

</body>
</html>
